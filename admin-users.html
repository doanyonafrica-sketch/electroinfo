<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion des Utilisateurs | ElectroInfo Admin</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="/admin-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ============ VARIABLES ============ */
        :root {
            --primary: #7c3aed;
            --primary-dark: #5b21b6;
            --primary-light: #a78bfa;
            --secondary: #eab308;
            --success: #16a34a;
            --danger: #dc2626;
            --warning: #f59e0b;
            --info: #0ea5e9;
            --gray-50: #f9fafb;
            --gray-100: #f3f4f6;
            --gray-200: #e5e7eb;
            --gray-300: #d1d5db;
            --gray-400: #9ca3af;
            --gray-500: #6b7280;
            --gray-600: #4b5563;
            --gray-700: #374151;
            --gray-800: #1f2937;
            --gray-900: #111827;
            --bg-body: #f1f5f9;
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
            --shadow-lg: 0 10px 25px rgba(0,0,0,0.15);
            --radius: 0.5rem;
            --radius-lg: 1rem;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-body); color: var(--gray-900); min-height: 100vh; }

        /* ============ NAVBAR ============ */
        .navbar { background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: white; box-shadow: var(--shadow); position: sticky; top: 0; z-index: 100; }
        .container { max-width: 1400px; margin: 0 auto; padding: 0 1rem; }
        .navbar .container { display: flex; justify-content: space-between; align-items: center; height: 64px; gap: .5rem; }
        .nav-brand { display: flex; align-items: center; gap: .75rem; font-size: 1.25rem; font-weight: 700; color: white; text-decoration: none; }
        .nav-brand i { font-size: 1.5rem; }
        .nav-actions { display: flex; gap: .75rem; align-items: center; }
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: .5rem; padding: .625rem 1.25rem; border: none; border-radius: var(--radius); font-weight: 600; font-size: .9375rem; cursor: pointer; transition: all .3s; text-decoration: none; white-space: nowrap; }
        .btn-outline { background: transparent; border: 2px solid white; color: white; }
        .btn-outline:hover { background: white; color: var(--primary); }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: var(--shadow); }
        .btn-danger { background: var(--danger); color: white; }
        .btn-danger:hover { background: #b91c1c; }
        .btn-success { background: var(--success); color: white; }
        .btn-success:hover { background: #15803d; }
        .btn-secondary { background: var(--gray-600); color: white; }
        .btn-secondary:hover { background: var(--gray-700); }
        .btn-warning { background: var(--warning); color: white; }
        .btn-sm { padding: .4rem .85rem; font-size: .8rem; }

        /* ============ LOADING / ACCESS DENIED ============ */
        .loading-section { min-height: calc(100vh - 64px); display: flex; align-items: center; justify-content: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid var(--gray-200); border-top-color: var(--primary); border-radius: 50%; animation: spin .8s linear infinite; margin: 0 auto 1rem; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .access-denied-card { background: white; border-radius: var(--radius-lg); padding: 3rem; text-align: center; box-shadow: var(--shadow-lg); max-width: 480px; }
        .access-denied-card i { font-size: 4rem; color: var(--danger); margin-bottom: 1rem; }
        .hidden { display: none !important; }

        /* ============ MAIN LAYOUT ============ */
        .admin-main { padding: 2rem 1rem; }

        /* ============ STATS CARDS ============ */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.25rem; margin-bottom: 2rem; }
        .stat-card { background: white; border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm); display: flex; align-items: center; gap: 1rem; border-left: 4px solid transparent; transition: box-shadow .2s; }
        .stat-card:hover { box-shadow: var(--shadow); }
        .stat-card.total { border-color: #3b82f6; }
        .stat-card.admins { border-color: var(--primary); }
        .stat-card.superadmins { border-color: var(--warning); }
        .stat-card.users { border-color: var(--success); }
        .stat-icon { width: 48px; height: 48px; border-radius: var(--radius); display: flex; align-items: center; justify-content: center; font-size: 1.4rem; flex-shrink: 0; }
        .stat-card.total .stat-icon { background: #eff6ff; color: #3b82f6; }
        .stat-card.admins .stat-icon { background: #f3e8ff; color: var(--primary); }
        .stat-card.superadmins .stat-icon { background: #fefce8; color: var(--warning); }
        .stat-card.users .stat-icon { background: #f0fdf4; color: var(--success); }
        .stat-number { font-size: 2rem; font-weight: 700; line-height: 1; }
        .stat-label { font-size: .875rem; color: var(--gray-500); margin-top: .25rem; }

        /* ============ CARD ============ */
        .card { background: white; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); margin-bottom: 1.5rem; overflow: hidden; }
        .card-header { padding: 1.25rem 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: .75rem; }
        .card-header h2 { font-size: 1.1rem; font-weight: 700; display: flex; align-items: center; gap: .5rem; }
        .card-body { padding: 1.5rem; }

        /* ============ SEARCH & FILTER ============ */
        .toolbar { display: flex; gap: 1rem; flex-wrap: wrap; margin-bottom: 1.5rem; }
        .search-wrap { position: relative; flex: 1; min-width: 220px; }
        .search-wrap i { position: absolute; left: .875rem; top: 50%; transform: translateY(-50%); color: var(--gray-400); pointer-events: none; }
        .search-input { width: 100%; padding: .75rem 1rem .75rem 2.5rem; border: 2px solid var(--gray-200); border-radius: var(--radius); font-size: .9375rem; transition: border-color .2s; }
        .search-input:focus { outline: none; border-color: var(--primary); }
        .filter-select { padding: .75rem 1rem; border: 2px solid var(--gray-200); border-radius: var(--radius); font-size: .9rem; background: white; cursor: pointer; }
        .filter-select:focus { outline: none; border-color: var(--primary); }

        /* ============ TABLE ============ */
        .table-wrap { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; font-size: .9rem; }
        thead th { padding: .875rem 1rem; text-align: left; font-weight: 600; color: var(--gray-600); background: var(--gray-50); border-bottom: 2px solid var(--gray-200); white-space: nowrap; }
        tbody tr { border-bottom: 1px solid var(--gray-100); transition: background .15s; }
        tbody tr:hover { background: var(--gray-50); }
        tbody td { padding: .875rem 1rem; vertical-align: middle; }

        /* ============ USER CELL ============ */
        .user-cell { display: flex; align-items: center; gap: .75rem; }
        .user-avatar { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        .user-avatar-placeholder { width: 38px; height: 38px; border-radius: 50%; background: linear-gradient(135deg, var(--primary-light), var(--primary)); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: .9rem; flex-shrink: 0; }
        .user-name { font-weight: 600; color: var(--gray-900); }
        .user-uid { font-size: .75rem; color: var(--gray-400); font-family: monospace; }

        /* ============ ROLE BADGES ============ */
        .role-badge { display: inline-flex; align-items: center; gap: .35rem; padding: .3rem .75rem; border-radius: 999px; font-size: .8rem; font-weight: 700; text-transform: uppercase; letter-spacing: .03em; }
        .role-badge.superadmin { background: linear-gradient(135deg, #fef3c7, #fde68a); color: #92400e; border: 1px solid #fcd34d; }
        .role-badge.admin { background: linear-gradient(135deg, #ede9fe, #ddd6fe); color: #5b21b6; border: 1px solid #c4b5fd; }
        .role-badge.user { background: #f0fdf4; color: #15803d; border: 1px solid #bbf7d0; }

        /* ============ PERMISSIONS GRID ============ */
        .perms-mini { display: flex; flex-wrap: wrap; gap: .3rem; }
        .perm-chip { background: var(--gray-100); color: var(--gray-600); padding: .2rem .5rem; border-radius: .25rem; font-size: .72rem; font-weight: 600; }
        .perm-chip.active { background: #ede9fe; color: var(--primary); }

        /* ============ ACTIONS ============ */
        .actions-cell { display: flex; gap: .5rem; flex-wrap: wrap; }

        /* ============ MODAL ============ */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.55); z-index: 1000; display: flex; align-items: center; justify-content: center; padding: 1rem; animation: fadeIn .2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .modal { background: white; border-radius: var(--radius-lg); width: 100%; max-width: 620px; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); animation: slideUp .25s ease; }
        @keyframes slideUp { from { transform: translateY(24px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .modal-header { padding: 1.5rem; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; background: white; z-index: 1; }
        .modal-header h3 { font-size: 1.2rem; font-weight: 700; display: flex; align-items: center; gap: .5rem; }
        .modal-body { padding: 1.5rem; }
        .modal-footer { padding: 1rem 1.5rem; border-top: 1px solid var(--gray-200); display: flex; justify-content: flex-end; gap: .75rem; position: sticky; bottom: 0; background: white; }
        .btn-icon { background: none; border: none; cursor: pointer; color: var(--gray-500); font-size: 1.2rem; width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; border-radius: var(--radius); transition: all .2s; }
        .btn-icon:hover { background: var(--gray-100); color: var(--gray-900); }

        /* ============ FORM ELEMENTS ============ */
        .form-group { margin-bottom: 1.25rem; }
        .form-group label { display: block; font-weight: 600; margin-bottom: .5rem; font-size: .9rem; color: var(--gray-700); }
        .form-control { width: 100%; padding: .75rem 1rem; border: 2px solid var(--gray-200); border-radius: var(--radius); font-size: .9375rem; transition: border-color .2s; }
        .form-control:focus { outline: none; border-color: var(--primary); }
        select.form-control { background: white; cursor: pointer; }

        /* ============ PERMISSIONS SECTION ============ */
        .permissions-section { background: var(--gray-50); border-radius: var(--radius); padding: 1.25rem; border: 1px solid var(--gray-200); }
        .permissions-section h4 { font-size: .95rem; font-weight: 700; color: var(--gray-700); margin-bottom: 1rem; display: flex; align-items: center; gap: .5rem; }
        .perms-grid { display: grid; grid-template-columns: 1fr 1fr; gap: .75rem; }
        @media (max-width: 480px) { .perms-grid { grid-template-columns: 1fr; } }
        .perm-toggle { display: flex; align-items: flex-start; gap: .75rem; background: white; border-radius: var(--radius); padding: .875rem 1rem; border: 2px solid var(--gray-200); cursor: pointer; transition: all .2s; }
        .perm-toggle:hover { border-color: var(--primary-light); }
        .perm-toggle.checked { border-color: var(--primary); background: #f5f3ff; }
        .perm-toggle input[type=checkbox] { display: none; }
        .perm-toggle-indicator { width: 20px; height: 20px; border-radius: .25rem; border: 2px solid var(--gray-300); background: white; flex-shrink: 0; margin-top: 1px; display: flex; align-items: center; justify-content: center; transition: all .2s; }
        .perm-toggle.checked .perm-toggle-indicator { background: var(--primary); border-color: var(--primary); }
        .perm-toggle.checked .perm-toggle-indicator::after { content: '✓'; color: white; font-size: .75rem; font-weight: 700; }
        .perm-toggle-text strong { display: block; font-size: .875rem; color: var(--gray-800); }
        .perm-toggle-text small { color: var(--gray-500); font-size: .78rem; }
        .perm-note { font-size: .8rem; color: var(--gray-500); margin-top: .75rem; font-style: italic; }

        /* ============ USER DETAIL MODAL ============ */
        .user-detail-header { display: flex; align-items: center; gap: 1rem; padding: 1rem; background: linear-gradient(135deg, #f5f3ff, #ede9fe); border-radius: var(--radius); margin-bottom: 1.5rem; }
        .user-detail-avatar { width: 60px; height: 60px; border-radius: 50%; border: 3px solid white; box-shadow: var(--shadow); }
        .user-detail-info h4 { font-size: 1.1rem; font-weight: 700; }
        .user-detail-info p { color: var(--gray-500); font-size: .875rem; }

        /* ============ TOAST ============ */
        .toast-container { position: fixed; top: 80px; right: 1rem; z-index: 2000; display: flex; flex-direction: column; gap: .5rem; }
        .toast { background: white; border-radius: var(--radius); padding: .875rem 1.25rem; box-shadow: var(--shadow-lg); display: flex; align-items: center; gap: .75rem; font-weight: 500; animation: toastIn .3s ease; border-left: 4px solid var(--primary); max-width: 340px; }
        .toast.success { border-color: var(--success); }
        .toast.error { border-color: var(--danger); }
        .toast i.success { color: var(--success); }
        .toast i.error { color: var(--danger); }
        .toast i.info { color: var(--info); }
        @keyframes toastIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* ============ EMPTY STATE ============ */
        .empty-row td { text-align: center; padding: 3rem; color: var(--gray-400); }
        .empty-row i { font-size: 2.5rem; display: block; margin-bottom: .75rem; color: var(--gray-300); }

        /* ============ PAGINATION ============ */
        .pagination { display: flex; justify-content: center; align-items: center; gap: .5rem; margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid var(--gray-200); }
        .page-btn { background: white; border: 1px solid var(--gray-300); padding: .5rem .875rem; border-radius: var(--radius); cursor: pointer; font-size: .875rem; color: var(--gray-700); transition: all .2s; min-width: 36px; font-weight: 500; }
        .page-btn:hover:not(:disabled) { background: var(--primary); border-color: var(--primary); color: white; }
        .page-btn:disabled { opacity: .4; cursor: not-allowed; }
        .page-btn.active { background: var(--primary); border-color: var(--primary); color: white; font-weight: 700; }

        /* ============ SUPERADMIN LOCK ============ */
        .lock-notice { background: #fef3c7; border: 1px solid #fcd34d; border-radius: var(--radius); padding: .75rem 1rem; display: flex; align-items: center; gap: .75rem; font-size: .875rem; color: #92400e; margin-bottom: 1rem; }
        .lock-notice i { color: #f59e0b; }
    </style>
</head>
<body>

<!-- ============ NAVBAR ============ -->
<nav class="navbar">
    <div class="container">
        <a href="admin.html" class="nav-brand">
            <i class="fas fa-bolt"></i>
            <span>ElectroInfo — Admin</span>
        </a>
        <div class="nav-actions">
            <a href="admin.html" class="btn btn-outline btn-sm"><i class="fas fa-arrow-left"></i> Retour</a>
            <button id="logoutBtn" class="btn btn-outline btn-sm"><i class="fas fa-sign-out-alt"></i> Déconnexion</button>
        </div>
    </div>
</nav>

<!-- ============ LOADING ============ -->
<div id="loadingSection" class="loading-section">
    <div style="text-align:center">
        <div class="spinner"></div>
        <p>Vérification des autorisations…</p>
    </div>
</div>

<!-- ============ ACCESS DENIED ============ -->
<div id="accessDenied" class="loading-section hidden">
    <div class="access-denied-card">
        <i class="fas fa-shield-alt"></i>
        <h2 style="margin-bottom:.5rem">Accès refusé</h2>
        <p style="color:#6b7280;margin-bottom:1.5rem">Vous devez être Super Administrateur pour accéder à cette page.</p>
        <a href="index.html" class="btn btn-primary">Retour à l'accueil</a>
    </div>
</div>

<!-- ============ MAIN DASHBOARD ============ -->
<main id="adminDashboard" class="admin-main hidden">
    <div class="container">

        <!-- Page title -->
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;margin-bottom:2rem">
            <div>
                <h1 style="font-size:1.75rem;font-weight:800;display:flex;align-items:center;gap:.75rem">
                    <i class="fas fa-users-cog" style="color:var(--primary)"></i> Gestion des Utilisateurs
                </h1>
                <p style="color:var(--gray-500);margin-top:.25rem">Gérez les rôles, permissions et accès de vos utilisateurs</p>
            </div>
            <div style="display:flex;gap:.75rem;flex-wrap:wrap">
                <a href="admin-newsletter.html" class="btn btn-outline" style="border-color:var(--primary);color:var(--primary)">
                    <i class="fas fa-envelope"></i> Newsletter
                </a>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card total">
                <div class="stat-icon"><i class="fas fa-users"></i></div>
                <div><div class="stat-number" id="statTotal">—</div><div class="stat-label">Utilisateurs total</div></div>
            </div>
            <div class="stat-card superadmins">
                <div class="stat-icon"><i class="fas fa-crown"></i></div>
                <div><div class="stat-number" id="statSuperAdmins">—</div><div class="stat-label">Super Admins</div></div>
            </div>
            <div class="stat-card admins">
                <div class="stat-icon"><i class="fas fa-user-shield"></i></div>
                <div><div class="stat-number" id="statAdmins">—</div><div class="stat-label">Administrateurs</div></div>
            </div>
            <div class="stat-card users">
                <div class="stat-icon"><i class="fas fa-user"></i></div>
                <div><div class="stat-number" id="statUsers">—</div><div class="stat-label">Utilisateurs</div></div>
            </div>
        </div>

        <!-- Superadmin notice -->
        <div class="lock-notice" id="superadminNotice" style="display:none">
            <i class="fas fa-info-circle"></i>
            <span>En tant que <strong>Super Admin</strong>, vous pouvez attribuer tous les rôles et configurer les permissions. Les actions sur d'autres Super Admins sont protégées.</span>
        </div>

        <!-- Users Table -->
        <div class="card">
            <div class="card-header">
                <h2><i class="fas fa-table" style="color:var(--primary)"></i> Liste des utilisateurs</h2>
                <span id="tableCount" style="color:var(--gray-500);font-size:.9rem"></span>
            </div>
            <div class="card-body">

                <!-- Toolbar -->
                <div class="toolbar">
                    <div class="search-wrap">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" class="search-input" placeholder="Rechercher par nom, email, UID…">
                    </div>
                    <select id="roleFilter" class="filter-select">
                        <option value="all">Tous les rôles</option>
                        <option value="superadmin">Super Admin</option>
                        <option value="admin">Admin</option>
                        <option value="user">Utilisateur</option>
                    </select>
                </div>

                <!-- Table -->
                <div class="table-wrap">
                    <table id="usersTable">
                        <thead>
                            <tr>
                                <th>Utilisateur</th>
                                <th>Email</th>
                                <th>Rôle</th>
                                <th>Permissions</th>
                                <th>Inscrit le</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <tr class="empty-row">
                                <td colspan="6">
                                    <div class="spinner" style="width:30px;height:30px;border-width:3px;margin:0 auto .5rem"></div>
                                    Chargement…
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div id="pagination" class="pagination"></div>

            </div>
        </div>

    </div>
</main>

<!-- ============ MODAL: EDIT USER ============ -->
<div id="editModal" class="modal-overlay hidden">
    <div class="modal">
        <div class="modal-header">
            <h3><i class="fas fa-user-edit" style="color:var(--primary)"></i> Modifier l'utilisateur</h3>
            <button class="btn-icon" onclick="closeEditModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <!-- User info header -->
            <div class="user-detail-header" id="editUserHeader"></div>

            <!-- Role -->
            <div class="form-group">
                <label><i class="fas fa-id-badge" style="color:var(--primary)"></i> Rôle</label>
                <select id="editRole" class="form-control">
                    <option value="user">Utilisateur</option>
                    <option value="admin">Administrateur</option>
                    <option value="superadmin">Super Administrateur</option>
                </select>
            </div>

            <!-- Permissions (visible only for admin role) -->
            <div id="permissionsSection" class="permissions-section hidden">
                <h4><i class="fas fa-sliders-h" style="color:var(--primary)"></i> Permissions de l'administrateur</h4>
                <div class="perms-grid">
                    <label class="perm-toggle" id="perm_articles" onclick="togglePerm(this)">
                        <input type="checkbox" value="articles">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-newspaper"></i> Articles</strong>
                            <small>Créer, modifier, supprimer les articles</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_courses" onclick="togglePerm(this)">
                        <input type="checkbox" value="courses">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-graduation-cap"></i> Cours</strong>
                            <small>Gérer les cours et séquences</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_newsletter" onclick="togglePerm(this)">
                        <input type="checkbox" value="newsletter">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-envelope"></i> Newsletter</strong>
                            <small>Gérer abonnés & envoyer des campagnes</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_users" onclick="togglePerm(this)">
                        <input type="checkbox" value="users">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-users"></i> Utilisateurs</strong>
                            <small>Voir la liste des utilisateurs (lecture seule)</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_stats" onclick="togglePerm(this)">
                        <input type="checkbox" value="stats">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-chart-bar"></i> Statistiques</strong>
                            <small>Accéder aux tableaux de bord</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_media" onclick="togglePerm(this)">
                        <input type="checkbox" value="media">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-image"></i> Médias</strong>
                            <small>Upload et gestion des fichiers</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_comments" onclick="togglePerm(this)">
                        <input type="checkbox" value="comments">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-comments"></i> Commentaires</strong>
                            <small>Modérer les commentaires</small>
                        </div>
                    </label>
                    <label class="perm-toggle" id="perm_settings" onclick="togglePerm(this)">
                        <input type="checkbox" value="settings">
                        <div class="perm-toggle-indicator"></div>
                        <div class="perm-toggle-text">
                            <strong><i class="fas fa-cog"></i> Paramètres</strong>
                            <small>Modifier les paramètres du site</small>
                        </div>
                    </label>
                </div>
                <p class="perm-note">* Les Super Admins ont toutes les permissions par défaut.</p>
            </div>

        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeEditModal()">Annuler</button>
            <button class="btn btn-primary" id="saveUserBtn" onclick="saveUserEdit()"><i class="fas fa-save"></i> Enregistrer</button>
        </div>
    </div>
</div>

<!-- ============ MODAL: CONFIRM DELETE / DEGRADE ============ -->
<div id="confirmModal" class="modal-overlay hidden">
    <div class="modal" style="max-width:440px">
        <div class="modal-header">
            <h3 id="confirmTitle"><i class="fas fa-exclamation-triangle" style="color:var(--warning)"></i> Confirmation</h3>
            <button class="btn-icon" onclick="closeConfirmModal()"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body">
            <p id="confirmMessage" style="color:var(--gray-700);line-height:1.7"></p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeConfirmModal()">Annuler</button>
            <button class="btn btn-danger" id="confirmActionBtn">Confirmer</button>
        </div>
    </div>
</div>

<!-- ============ TOAST CONTAINER ============ -->
<div class="toast-container" id="toastContainer"></div>

<!-- ============ FIREBASE + SCRIPT ============ -->
<script type="module" src="/admin-users.js"></script>

</body>
</html>
